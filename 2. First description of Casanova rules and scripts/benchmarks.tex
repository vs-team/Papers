%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% benchmarks.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We have slightly modified the original sample so that testing could be automated. For this reason we have removed the 30 seconds time limit of each level, we have removed the victory and ending conditions, we have automated ships movement and shooting and we have increased the maximum number of asteroids and projectiles to 12 and 200 respectively. This way we have obtained an automated stress test.

We have also removed all rendering features, to avoid benchmarking rendering algorithms: Casanova does not generate rendering code, so such a comparison would have been meaningless.

We have benhcmarked the modified sample on both the Xbox 360 and a 1.86 Ghz Intel Core 2 Duo with an nVidia GeForce 320M GPU and 4GB of RAM. The resulting framerates of the original sample are reported in Table \ref{table:reference_fps}:

\begin{table}[ht] 
\center
\begin{tabular}{|cc|} 
\hline
Platform & Framerate \\ 
\hline
Xbox & 9 \\
PC & 8 \\
\hline
\end{tabular} 
\caption{Spacewar Sample Framerate}
\label{table:reference_fps}
\end{table}

The Casanova program has been compiled with all possible combinations of query optimization and multi-threaded optimization. The resulting framerates of the rewritten sample run under the Xbox 360 are reported in Table \ref{table:xbox_fps}:

\begin{table}[ht] 
\center
\begin{tabular}{|ccc|} 
\hline
Query Optimization & MT Optimization & Framerate \\ 
\hline
No & No & 3 \\
No & Yes & 6 \\
Yes & No & 18 \\
Yes & Yes & 22 \\
\hline
\end{tabular} 
\caption{Casanova Xbox Framerate}
\label{table:xbox_fps}
\end{table}

The resulting framerates of the rewritten sample run under a PC are reported in Table \ref{table:pc_fps}:

\begin{table}[ht] 
\center
\begin{tabular}{|cccc|} 
\hline
Query Optimization & MT Optimization & Framerate & \% of CPU used \\ 
\hline
No & No & 22 & 50 \\
No & Yes & 93 & 97 \\
Yes & No & 510 & 50 \\
Yes & Yes & 577 & 85 \\
\hline
\end{tabular} 
\caption{Casanova PC Framerate}
\label{table:pc_fps}
\end{table}

As we can see, full Casanova optimization always beats the original source by at least a factor of 2. The Xbox implementation suffers from the generation of garbage, which is a known problem of the XNA implementation on the console (\cite{XBOX_GC}); indeed, profiling the garbage collector shows that large amounts of temporary memory are being generated by the program. It is noticeable that full optimization on the PC actually increased performance by almost two orders of magnitude: such an impressive increase was quite unexpected.


As a final remark, it is worth noticing that while the original sample includes more than one thousand lines of code the length of the corresponding Casanova program is 348 lines long. The Casanova source easily fits a few pages, while navigating the original source may prove a bit complex because of its sheer size.